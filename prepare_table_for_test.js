const _data = [{ "algorithm": "gpu_naive_full", "complementary": false, "count": 10, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 738.3516034985423, "gmps_total": 738.3516034985423, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 6.69921875, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_external", "complementary": false, "count": 10, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 645.3990825688073, "gmps_total": 645.3990825688073, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 7.6640625, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_full", "complementary": true, "count": 10, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 900.3007465339496, "gmps_total": 900.3007465339496, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 10.98828125, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_external", "complementary": true, "count": 10, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 860.8416130523455, "gmps_total": 1721.6492182188988, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 1281470625, "prefix": 5, "result": 5.74609375, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_full", "complementary": false, "count": 50, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 958.2813682457999, "gmps_total": 958.2813682457999, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 25.80859375, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_external", "complementary": false, "count": 50, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 908.3737446197991, "gmps_total": 908.3737446197991, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 27.2265625, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_full", "complementary": true, "count": 50, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 1020.611751430644, "gmps_total": 1020.611751430644, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 48.46484375, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_external", "complementary": true, "count": 50, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 1031.3552800130315, "gmps_total": 2062.6698159309335, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 1281470625, "prefix": 5, "result": 23.98046875, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_full", "complementary": false, "count": 100, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 989.1212310576473, "gmps_total": 989.1212310576473, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 50.0078125, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_external", "complementary": false, "count": 100, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 955.6777358490566, "gmps_total": 955.6777358490566, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 51.7578125, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_full", "complementary": true, "count": 100, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 1045.5561060193213, "gmps_total": 1045.5561060193213, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 94.6171875, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_external", "complementary": true, "count": 100, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 1053.317262352354, "gmps_total": 2106.5929129928463, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 1281470625, "prefix": 5, "result": 46.9609375, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_full", "complementary": false, "count": 500, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 1013.180508881421, "gmps_total": 1013.180508881421, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 244.1015625, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_external", "complementary": false, "count": 500, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 993.7476456554496, "gmps_total": 993.7476456554496, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 248.875, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_full", "complementary": true, "count": 500, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 1057.7042908811468, "gmps_total": 1057.7042908811468, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 467.65234375, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_external", "complementary": true, "count": 500, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 1071.4087594551147, "gmps_total": 2142.775192486674, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 1281470625, "prefix": 5, "result": 230.83984375, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_full", "complementary": false, "count": 1000, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 1016.2215302633902, "gmps_total": 1016.2215302633902, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 486.7421875, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_external", "complementary": false, "count": 1000, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 997.4816261904574, "gmps_total": 997.4816261904574, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 495.88671875, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_full", "complementary": true, "count": 1000, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 1059.4299052909876, "gmps_total": 1059.4299052909876, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 2562890625, "prefix": 5, "result": 933.78125, "suffix": 0, "threads_per_block": 512, "unified_memory": false }, { "algorithm": "gpu_naive_external", "complementary": true, "count": 1000, "external_min_presence": 100, "external_stat_model": "ideal", "gmps": 1074.4906812839943, "gmps_total": 2148.9389143919016, "gpus": 1, "length": 200, "motif_chunk_size": 8388608, "motifs_count": 1281470625, "prefix": 5, "result": 460.35546875, "suffix": 0, "threads_per_block": 512, "unified_memory": false }];

function unique(arr) {
  return Array.from(new Set(arr));
}

const dataAccumulate = (data) => {
  if (!data[0]) {
    console.log("data is empty!");
    return false;
  }

  let initialValue = {};

  for (let key in data[0]) {
    initialValue[key] = [];
  }

  return data.reduce((result, item, index) => {
    for (let key in result) {
      result[key].push(item[key]);

      if (index == data.length - 1 && result[key].length > 1) {
        result[key] = unique(result[key])
      }

      if (index == data.length - 1 && result[key].length <= 1 || key == "algorithm") {
        delete result[key];
      }
    }

    return result;
  }, initialValue);
}



const arr小omparison = (a, b) => {
  return a.filter(v => b.some(v2 => v == v2));
}


const getAxises = (data) => {
  const preferencesY = ["gmps", "gmps_total", "result"];
  const preferencesX = ["external_min_presence", "complementary", "count", "gpus", "length", "motif_chunk_size", "prefix", "suffix", "threads_per_block", "unified_memory"];
  const initialFilterState = {
    yAxisSelected: "",
    yAxisChoice: [],
    xAxisSelected: "",
    xAxisChoice: [],
    checkbox: []
  }

  initialFilterState.yAxisChoice = arr小omparison(Object.keys(data), preferencesY);
  initialFilterState.yAxisSelected = initialFilterState.yAxisChoice[0];
  initialFilterState.xAxisChoice = arr小omparison(Object.keys(data), preferencesX);
  initialFilterState.xAxisSelected = initialFilterState.xAxisChoice[0];

  for (let key in data) {
    if (data[key].length < 10) {
      data[key].map(item => {
        initialFilterState.checkbox.push({
          key: key,
          value: item,
          checked: false
        });
      });
    }
  }

  return initialFilterState;
}

const getState = (inputData) => {
  const preferencesY = ["gmps", "gmps_total", "result"];
  const _skip_keys = ["external_stat_model", "gmps", "gmps_total", "result", "motifs_count"]
  const initialFilterState = {
    yAxisSelected: "",
    yAxisChoice: [],
    xAxisSelected: "",
    xAxisChoice: [],
    checkbox: []
  }

  let data = dataAccumulate(inputData);

  initialFilterState.yAxisChoice = arr小omparison(Object.keys(data), preferencesY);
  initialFilterState.yAxisSelected = initialFilterState.yAxisChoice[0];
  initialFilterState.xAxisChoice = Object.keys(data).filter(item => {

    for (let i = 0; i < _skip_keys.length; i++) {
      if (item == _skip_keys[i]) {
        return false;
      }
    }
    return true;
  });
  initialFilterState.xAxisSelected = initialFilterState.xAxisChoice[0];

  for (let key in data) {
    if (data[key].length < 10) {
      data[key].map(item => {
        initialFilterState.checkbox.push({
          key: key,
          value: item,
          checked: false,
          visible: (initialFilterState.yAxisSelected == key || initialFilterState.xAxisSelected == key) ? false : true
        });
      });
    }
  }

  return initialFilterState;
}
//-----getChart-----

const getName = (data, checkbox) => {
  let seriesFilter = [];

  data.map(item => {
    let line = { name: [`${item.algorithm}`], key: { algorithm: item.algorithm } };
    let length = [];

    for (let i = 0; i < checkbox.length; i++) {
      let { key, value, color } = checkbox[i];
      length.push(key);

      if (item[key].toString() === value) {
        line.name.push(`<span style="${color}">_${value}</span>`);
        line.key[key] = value;
      }
    }

    length = Array.from(new Set(length)).length;

    if (line.name.length == length + 1) {
      let name = line.name.join('');
      seriesFilter.push({ name: name, keys: line.key });
    }
  });

  return [...seriesFilter.reduce((series, item) => (series.set(item.name, item), series), new Map()).values()];
}

const getChart = (data, filterOptions, checkbox) => {
  const { yAxisSelected, xAxisSelected } = filterOptions;
  return new Promise(resolve => {
    const initialState = {
      xAxis: {
        categories: [],
        title: {
          text: xAxisSelected
        }
      },
      yAxis: {
        title: {
          text: yAxisSelected
        }
      },
      series: []
    };

    let seriesFilter = getName(data, checkbox);

    let series = seriesFilter.reduce((seriesArr, item) => {
      let optionData = [];

      for (let i = 0; i < data.length; i++) {
        let check = true;

        for (let key in item.keys) {

          if (item.keys[key] != data[i][key].toString()) {
            check = false;
          }
        }

        if (check) {
          initialState.xAxis.categories.push(data[i][xAxisSelected]);
          optionData.push(data[i][yAxisSelected]);
        }
      }

      initialState.xAxis.categories = Array.from(new Set(initialState.xAxis.categories));
      optionData = Array.from(new Set(optionData));

      seriesArr.push({
        name: item.name,
        data: optionData
      });

      return seriesArr;
    }, []);

    initialState.series = series;

    resolve(initialState);
  });
}

const getChart2 = (data, filterOptions) => {
  const { yAxisSelected, xAxisSelected, checkbox } = filterOptions;

  let checkedBox = checkbox.filter(item => {
    return item.checked;
  })

  return new Promise(resolve => {
    const initialState = {
      xAxis: {
        categories: [],
        title: {
          text: xAxisSelected
        }
      },
      yAxis: {
        title: {
          text: yAxisSelected
        }
      },
      series: []
    };

    let seriesFilter = getName(data, checkedBox);

    let series = seriesFilter.reduce((seriesArr, item) => {
      let optionData = [];

      for (let i = 0; i < data.length; i++) {
        let check = true;

        for (let key in item.keys) {

          if (item.keys[key] != data[i][key].toString()) {
            check = false;
          }
        }

        if (check) {
          initialState.xAxis.categories.push(data[i][xAxisSelected]);
          optionData.push(data[i][yAxisSelected]);
        }
      }

      initialState.xAxis.categories = Array.from(new Set(initialState.xAxis.categories));
      optionData = Array.from(new Set(optionData));

      seriesArr.push({
        name: item.name,
        data: JSON.stringify(optionData)
      });

      return seriesArr;
    }, []);

    initialState.series = series;

    resolve(initialState);
  });
}



let dataFilter = {
  "yAxisSelected": "gmps",
  "yAxisChoice": ["gmps", "gmps_total", "result"],
  "xAxisSelected": "count",
  "xAxisChoice": ["complementary", "count"],
  "checkbox": [{
    "checked": !false,
    "color": "#0000CD",
    "key": "complementary",
    "value": "false",
    "visible": false
  }, {
    "checked": !false,
    "color": "#0000CD",
    "key": "complementary",
    "value": "true",
    "visible": false
  }, {
    "checked": false,
    "color": "#008000",
    "key": "count",
    "value": "10",
    "visible": true
  }, {
    "checked": false,
    "color": "#008000",
    "key": "count",
    "value": "50",
    "visible": true
  }, {
    "checked": false,
    "color": "#008000",
    "key": "count",
    "value": "100",
    "visible": true
  }, {
    "checked": false,
    "color": "#008000",
    "key": "count",
    "value": "500",
    "visible": true
  }, {
    "checked": false,
    "color": "#008000",
    "key": "count",
    "value": "1000",
    "visible": true
  }, {
    "checked": false,
    "color": "#800080",
    "key": "motifs_count",
    "value": "2562890625",
    "visible": true
  }, {
    "checked": false,
    "color": "#800080",
    "key": "motifs_count",
    "value": "1281470625",
    "visible": true
  }]
}

//console.log(getState(_data));
getChart(_data, dataFilter,  [
  { key: 'complementary', value: 'false', color: '#0000CD' },
  { key: 'complementary', value: 'true', color: '#0000CD' }
]).then(data => {
  // console.log(data);
});
getChart2(_data, dataFilter).then(data => {
  console.log(data);
});